import{r as a,j as e,$ as p}from"./app-iFD7Weej.js";import{A as g}from"./AuthenticatedLayout-DWhC2xWj.js";import"./ApplicationLogo-BMRKG7mZ.js";import"./Dropdown-CjFkiSaH.js";import"./transition-F1nsk1y3.js";import"./LanguageSwitcher-CvGVWDg5.js";import"./translations-rX8tNeDX.js";function k({auth:m,diagnosticData:r}){const[x,h]=a.useState({});a.useEffect(()=>{r.sample_images&&j()},[r]);const j=async()=>{const s={};for(const i of r.sample_images){const d=[`/storage/${i.chemin_fichier}`,`/images/${i.chemin_fichier}`,i.asset_url,i.storage_url];s[i.id]={};for(const c of d)try{const t=await fetch(c,{method:"HEAD"});s[i.id][c]={status:t.status,ok:t.ok,contentType:t.headers.get("content-type"),contentLength:t.headers.get("content-length")}}catch(t){s[i.id][c]={status:"ERROR",error:t.message}}}h(s),console.log("üîç Property Images URL Test Results:",s)},l=({condition:s,trueText:i="‚úÖ YES",falseText:d="‚ùå NO"})=>e.jsx("span",{className:`px-2 py-1 rounded text-sm font-medium ${s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s?i:d}),o=({result:s})=>s?s.error?e.jsxs("span",{className:"text-red-600",children:["‚ùå ",s.error]}):e.jsxs("span",{className:s.ok?"text-green-600":"text-red-600",children:[s.ok?"‚úÖ":"‚ùå"," ",s.status,s.contentType&&e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.contentType,")"]})]}):e.jsx("span",{className:"text-gray-400",children:"Testing..."});return e.jsxs(g,{user:m.user,children:[e.jsx(p,{title:"Property Images Diagnostic"}),e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"üîç Property Images Diagnostic"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Database"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Total Images: ",e.jsx("strong",{children:r.total_images})]}),e.jsxs("div",{children:["With Properties: ",e.jsx("strong",{children:r.images_with_properties})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Storage"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Storage Path: ",e.jsx(l,{condition:r.storage_exists})]}),e.jsxs("div",{children:["Properties Folder: ",e.jsx(l,{condition:r.properties_folder_exists})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"Public Access"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Public Symlink: ",e.jsx(l,{condition:r.public_symlink_exists})]}),e.jsxs("div",{children:["Symlink Valid: ",e.jsx(l,{condition:r.symlink_valid})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-700 mb-2",children:"File System"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Property Dirs: ",e.jsx("strong",{children:r.property_directories_count})]}),e.jsxs("div",{children:["Total Files: ",e.jsx("strong",{children:r.total_property_files})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"üìÅ Storage Paths"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Storage Paths"}),e.jsxs("div",{className:"space-y-2 text-sm font-mono bg-gray-50 p-3 rounded",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Storage Root:"})," ",r.storage_path]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Properties:"})," ",r.properties_storage_path]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Public Root:"})," ",r.public_path]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Profile Images (Working)"}),e.jsxs("div",{className:"space-y-2 text-sm bg-green-50 p-3 rounded",children:[e.jsxs("div",{children:["Storage Exists: ",e.jsx(l,{condition:r.profile_storage_exists})]}),e.jsxs("div",{children:["Public Exists: ",e.jsx(l,{condition:r.profile_public_exists})]}),e.jsxs("div",{children:["Files Count: ",e.jsx("strong",{children:r.profile_files_count})]})]})]})]})]}),r.sample_images&&r.sample_images.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"üñºÔ∏è Sample Property Images Analysis"}),r.sample_images.map(s=>{var i,d,c,t;return e.jsx("div",{className:"bg-white rounded-lg border p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3",children:["Image ",s.id,s.property&&e.jsxs("span",{className:"text-sm font-normal text-gray-600 ml-2",children:["(",s.property.type_propriete," in ",s.property.ville,")"]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Database Path:"})," ",e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded",children:s.chemin_fichier})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Original Name:"})," ",s.nom_fichier]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Display Order:"})," ",s.ordre_affichage]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Created:"})," ",new Date(s.created_at).toLocaleString()]})]}),e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs("div",{children:["Storage File: ",e.jsx(l,{condition:s.storage_file_exists})]}),e.jsxs("div",{children:["Public File: ",e.jsx(l,{condition:s.public_file_exists})]}),s.file_size&&e.jsxs("div",{children:["File Size: ",e.jsxs("strong",{children:[(s.file_size/1024).toFixed(1)," KB"]})]}),s.mime_type&&e.jsxs("div",{children:["Type: ",e.jsx("strong",{children:s.mime_type})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"URL Tests"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Storage URL"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded flex-1 mr-2",children:["/storage/",s.chemin_fichier]}),e.jsx(o,{result:(i=x[s.id])==null?void 0:i[`/storage/${s.chemin_fichier}`]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Images URL"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded flex-1 mr-2",children:["/images/",s.chemin_fichier]}),e.jsx(o,{result:(d=x[s.id])==null?void 0:d[`/images/${s.chemin_fichier}`]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Asset URL"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded flex-1 mr-2",children:s.asset_url}),e.jsx(o,{result:(c=x[s.id])==null?void 0:c[s.asset_url]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Storage Facade URL"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded flex-1 mr-2",children:s.storage_url}),e.jsx(o,{result:(t=x[s.id])==null?void 0:t[s.storage_url]})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 mb-2",children:"Visual Test"}),e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("img",{src:`/storage/${s.chemin_fichier}`,alt:"Property test",className:"w-32 h-24 object-cover rounded",onError:n=>{console.log("‚ùå Visual test failed for:",n.target.src),n.target.style.display="none",n.target.nextElementSibling.style.display="block"},onLoad:n=>{console.log("‚úÖ Visual test success for:",n.target.src)}}),e.jsx("div",{className:"w-32 h-24 bg-red-100 border-2 border-red-300 rounded flex items-center justify-center text-red-600 text-xs",style:{display:"none"},children:"Image Failed"})]})]})]})]})},s.id)})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"‚öôÔ∏è Laravel Storage Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Filesystem Config"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Default Disk:"})," ",r.default_disk]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Public Disk Root:"})," ",e.jsx("code",{className:"text-xs",children:r.public_disk_root})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Public Disk URL:"})," ",e.jsx("code",{className:"text-xs",children:r.public_disk_url})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Storage Facade Test"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Public Disk Works: ",e.jsx(l,{condition:r.storage_facade_works})]}),e.jsxs("div",{children:["Sample Image Exists: ",e.jsx(l,{condition:r.sample_image_exists_via_storage})]})]})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-yellow-800 mb-4",children:"üõ†Ô∏è Recommended Actions"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[!r.public_symlink_exists&&e.jsxs("div",{className:"text-red-600",children:["‚ùå ",e.jsx("strong",{children:"CRITICAL:"})," Run ",e.jsx("code",{children:"php artisan storage:link"})]}),!r.symlink_valid&&e.jsxs("div",{className:"text-red-600",children:["‚ùå ",e.jsx("strong",{children:"CRITICAL:"})," Symlink is broken - recreate it"]}),r.total_images>0&&r.images_with_accessible_files===0&&e.jsxs("div",{className:"text-red-600",children:["‚ùå ",e.jsx("strong",{children:"CRITICAL:"})," No image files are accessible via web"]}),r.public_symlink_exists&&r.symlink_valid&&e.jsx("div",{className:"text-green-600",children:"‚úÖ Storage symlink is working correctly"})]})]})]})})]})}export{k as default};
